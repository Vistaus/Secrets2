app-id: io.github.tobagin.secrets
runtime: org.gnome.Platform
runtime-version: '48'
sdk: org.gnome.Sdk
command: io.github.tobagin.secrets

finish-args:
  # X11 + XShm access
  - --share=ipc
  - --socket=fallback-x11
  # Wayland access
  - --socket=wayland
  # Needs to talk to the network for git operations
  - --share=network
  # Access to home directory for password store
  - --filesystem=home
  # Access to GPG agent
  - --socket=gpg-agent
  # Access to SSH agent for git operations
  - --socket=ssh-auth
  # Access to clipboard
  - --talk-name=org.freedesktop.secrets
  # Access to keyring
  - --talk-name=org.freedesktop.portal.Secret
  # Environment variables for GPG
  - --env=GPG_TTY=/dev/pts/0



cleanup:
  - /include
  - /lib/pkgconfig
  - /man
  - /share/doc
  - /share/gtk-doc
  - /share/man
  - /share/pkgconfig
  - '*.la'
  - '*.a'

modules:
  - name: python3-pyotp
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST} "pyotp" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/c3/c0/c33c8792c3e50193ef55adb95c1c3c2786fe281123291c2dbf0eaab95a6f/pyotp-2.9.0-py3-none-any.whl
        sha256: 81c2e5865b8ac55e825b0358e496e1d9387c811e85bb40e71a3b29b288963612

  - name: pass
    buildsystem: simple
    build-commands:
      - make install PREFIX=/app
    sources:
      - type: archive
        url: https://git.zx2c4.com/password-store/snapshot/password-store-1.7.4.tar.xz
        sha256: cfa9faf659f2ed6b38e7a7c3fb43e177d00edbacc6265e6e32215ff40e3793c0
        x-checker-data:
          type: anitya
          project-id: 3651
          stable-only: true
          url-template: https://git.zx2c4.com/password-store/snapshot/password-store-$version.tar.xz

  - name: tree
    buildsystem: simple
    build-commands:
      - make install PREFIX=/app
    sources:
      - type: archive
        url: https://gitlab.com/OldManProgrammer/unix-tree/-/archive/2.1.1/unix-tree-2.1.1.tar.gz
        sha256: bcd2a0327ad40592a9c43e09a4d2ef834e6f17aa9a59012a5fb1007950b5eced

  - name: secrets
    buildsystem: meson
    sources:
      - type: git
        url: https://github.com/tobagin/Secrets.git
        tag: v0.6.2
