app-id: io.github.tobagin.secrets
runtime: org.gnome.Platform
runtime-version: '46'
sdk: org.gnome.Sdk
command: io.github.tobagin.secrets

finish-args:
  # X11 + XShm access
  - --share=ipc
  - --socket=fallback-x11
  # Wayland access
  - --socket=wayland
  # Needs to talk to the network for git operations
  - --share=network
  # Access to home directory for password store
  - --filesystem=home
  # Access to GPG agent
  - --socket=gpg-agent
  # Access to SSH agent for git operations
  - --socket=ssh-auth
  # Access to clipboard
  - --talk-name=org.freedesktop.secrets
  # Access to keyring
  - --talk-name=org.freedesktop.portal.Secret

cleanup:
  - /include
  - /lib/pkgconfig
  - /man
  - /share/doc
  - /share/gtk-doc
  - /share/man
  - /share/pkgconfig
  - '*.la'
  - '*.a'

modules:
  - name: pass
    buildsystem: simple
    build-commands:
      - make install PREFIX=/app
    sources:
      - type: archive
        url: https://git.zx2c4.com/password-store/snapshot/password-store-1.7.4.tar.xz
        sha256: cfa9faf659f2ed6b38e4a1c82a5dc75c70006c2c3824b5a4d5e72b5d6c6c6c6c
        x-checker-data:
          type: anitya
          project-id: 3651
          stable-only: true
          url-template: https://git.zx2c4.com/password-store/snapshot/password-store-$version.tar.xz

  - name: tree
    buildsystem: simple
    build-commands:
      - make install PREFIX=/app
    sources:
      - type: archive
        url: https://mama.indstate.edu/users/ice/tree/src/tree-2.1.1.tgz
        sha256: 6957c20e82561ac4231638996e74f4cfa4e6faabc5a2f511f0b4e3940e8f7b12
        x-checker-data:
          type: anitya
          project-id: 5040
          stable-only: true
          url-template: https://mama.indstate.edu/users/ice/tree/src/tree-$version.tgz

  - name: secrets
    buildsystem: meson
    sources:
      - type: git
        url: https://github.com/tobagin/Secrets.git
        tag: v0.1.0
        commit: HEAD  # This will be updated when you create the tag
