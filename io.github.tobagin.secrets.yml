app-id: io.github.tobagin.secrets
runtime: org.gnome.Platform
runtime-version: '48'
sdk: org.gnome.Sdk
command: io.github.tobagin.secrets

finish-args:
  # X11 + XShm access
  - --share=ipc
  - --socket=fallback-x11
  # Wayland access
  - --socket=wayland
  # Needs to talk to the network for git operations
  - --share=network
  # Access to home directory for password store
  - --filesystem=home
  # Access to GPG agent
  - --socket=gpg-agent
  # Access to SSH agent for git operations
  - --socket=ssh-auth
  # Access to clipboard
  - --talk-name=org.freedesktop.secrets
  # Access to keyring
  - --talk-name=org.freedesktop.portal.Secret
  # Environment variables for GPG
  - --env=GPG_TTY=/dev/pts/0
  # Allow access to session bus for pinentry
  - --socket=session-bus



cleanup:
  - /include
  - /lib/pkgconfig
  - /man
  - /share/doc
  - /share/gtk-doc
  - /share/man
  - /share/pkgconfig
  - '*.la'
  - '*.a'

modules:
  - name: python3-requests
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST} "requests" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/7c/e4/56027c4a6b4ae70ca9de302488c5ca95ad4a39e190093d6c1a8ace08341b/requests-2.32.4-py3-none-any.whl
        sha256: 27babd3cda2a6d50b30443204ee89830707d396671944c998b5975b031ac2b2c
      - type: file
        url: https://files.pythonhosted.org/packages/12/90/3c9ff0512038035f59d279fddeb79f5f1eccd8859f06d6163c58798b9d2/certifi-2024.8.30-py3-none-any.whl
        sha256: 922820b53db7a7257ffbda3f597266d435245903d80737e34f8a45ff3e3230d8
      - type: file
        url: https://files.pythonhosted.org/packages/63/09/c1bc53dab74b1816a00d8d030de5bf98f724c52c1635e07681d312f20be/charset_normalizer-3.4.0-py3-none-any.whl
        sha256: fe9f97feb71aa9896b81973a7bbada8c49501dc73e58a10fcef6663af95e5079
      - type: file
        url: https://files.pythonhosted.org/packages/76/c6/c88e154df9c4e1a2a66ccf0005a88dfb2650c1dffb6f5ce603dfbd452ce3/idna-3.10-py3-none-any.whl
        sha256: 946d195a0d259cbba61165e88e65941f16e9b36ea6ddb97f00452bae8b1287d3
      - type: file
        url: https://files.pythonhosted.org/packages/ca/1c/89ffc63a9605b583d5df2be791a27bc1a42b7c32bab68d3c8f2f73a98cd4/urllib3-2.2.3-py3-none-any.whl
        sha256: ca899ca043dcb1bafa3e262d73aa25c465bfb49e0bd9dd5d59f1d0acba2f8fac

  - name: python3-pyotp
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST} "pyotp" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/c3/c0/c33c8792c3e50193ef55adb95c1c3c2786fe281123291c2dbf0eaab95a6f/pyotp-2.9.0-py3-none-any.whl
        sha256: 81c2e5865b8ac55e825b0358e496e1d9387c811e85bb40e71a3b29b288963612

  - name: pass
    buildsystem: simple
    build-commands:
      - make install PREFIX=/app
    sources:
      - type: archive
        url: https://git.zx2c4.com/password-store/snapshot/password-store-1.7.4.tar.xz
        sha256: cfa9faf659f2ed6b38e7a7c3fb43e177d00edbacc6265e6e32215ff40e3793c0
        x-checker-data:
          type: anitya
          project-id: 3651
          stable-only: true
          url-template: https://git.zx2c4.com/password-store/snapshot/password-store-$version.tar.xz

  - name: tree
    buildsystem: simple
    build-commands:
      - make install PREFIX=/app
    sources:
      - type: archive
        url: https://gitlab.com/OldManProgrammer/unix-tree/-/archive/2.1.1/unix-tree-2.1.1.tar.gz
        sha256: bcd2a0327ad40592a9c43e09a4d2ef834e6f17aa9a59012a5fb1007950b5eced

  - name: secrets
    buildsystem: meson
    sources:
      - type: git
        url: https://github.com/tobagin/Secrets.git
        tag: v0.7.0
        commit: e905dfe498ecb4a5ba303992414fa4f60b8da221
