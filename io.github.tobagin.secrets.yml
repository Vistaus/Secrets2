app-id: io.github.tobagin.secrets
runtime: org.gnome.Platform
runtime-version: '46'
sdk: org.gnome.Sdk
command: io.github.tobagin.secrets

finish-args:
  # X11 + XShm access
  - --share=ipc
  - --socket=fallback-x11
  # Wayland access
  - --socket=wayland
  # Needs to talk to the network for git operations
  - --share=network
  # Access to home directory for password store
  - --filesystem=home
  # Access to GPG agent
  - --socket=gpg-agent
  # Access to SSH agent for git operations
  - --socket=ssh-auth
  # Access to clipboard
  - --talk-name=org.freedesktop.secrets
  # Access to keyring
  - --talk-name=org.freedesktop.portal.Secret

cleanup:
  - /include
  - /lib/pkgconfig
  - /man
  - /share/doc
  - /share/gtk-doc
  - /share/man
  - /share/pkgconfig
  - '*.la'
  - '*.a'

modules:
  - name: pass
    buildsystem: simple
    build-commands:
      - make install PREFIX=/app
    sources:
      - type: archive
        url: https://git.zx2c4.com/password-store/snapshot/password-store-1.7.4.tar.xz
        sha256: cfa9faf659f2ed6b38e7a7c3fb43e177d00edbacc6265e6e32215ff40e3793c0
        x-checker-data:
          type: anitya
          project-id: 3651
          stable-only: true
          url-template: https://git.zx2c4.com/password-store/snapshot/password-store-$version.tar.xz

  - name: tree
    buildsystem: simple
    build-commands:
      - make install PREFIX=/app
    sources:
      - type: archive
        url: https://gitlab.com/OldManProgrammer/unix-tree/-/archive/2.1.1/unix-tree-2.1.1.tar.gz
        sha256: bcd2a0327ad40592a9c43e09a4d2ef834e6f17aa9a59012a5fb1007950b5eced

  - name: secrets
    buildsystem: meson
    sources:
      - type: git
        url: https://github.com/tobagin/Secrets.git
        commit: c890212f97c5bffc6c0b1b04b3d5ab6b8e2e69c2
